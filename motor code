#include <Adafruit_MotorShield.h>

Adafruit_MotorShield AFMS = Adafruit_MotorShield();
Adafruit_StepperMotor *myStepper1 = AFMS.getStepper(200, 2);

unsigned long previousMillis = 0;
unsigned long stepInterval = 500;   // Default: one step every 500 ms
bool stepDirection = true;

void setup() {
  Serial.begin(9600);
  Serial.println("Stepper millis timing test!");

  if (!AFMS.begin()) {
    Serial.println("Could not find Motor Shield. Check wiring.");
    while (1);
  }
  Serial.println("Motor Shield found.");
  Serial.println("Enter interval in milliseconds (e.g. 200):");
}

void loop() {
  // Check for user input (non-blocking)
  if (Serial.available() > 0) {
    String input = Serial.readStringUntil('\n');
    input.trim();  // remove extra spaces or newlines
    if (input.length() > 0 && input.toInt() > 0) {
      stepInterval = input.toInt();
      Serial.print("Step interval updated to: ");
      Serial.print(stepInterval);
      Serial.println(" ms");
    }
  }

  unsigned long currentMillis = millis();

  // Only step when enough time has passed
  if (currentMillis - previousMillis >= stepInterval) {
    previousMillis += stepInterval; // DONâ€™T reset to 0, just move forward
    if (stepDirection) {
      myStepper1->onestep(FORWARD, DOUBLE);
    } else {
      myStepper1->onestep(BACKWARD, DOUBLE);
    }
  }
}
